<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Encoders · Skunk</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='docs'/>
<link rel="canonical" href="https://github.com/tpolecat/skunkreference/Encoders.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Skunk
</a>
<div class="version-number">
0.4
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../tutorial/Index.html" class="page">Tutorial</a>
  <ul>
    <li><a href="../tutorial/Setup.html" class="page">Setup</a></li>
    <li><a href="../tutorial/Query.html" class="page">Queries</a></li>
    <li><a href="../tutorial/Command.html" class="page">Commands</a></li>
    <li><a href="../tutorial/Transactions.html" class="page">Transactions</a></li>
    <li><a href="../tutorial/Channels.html" class="page">Channels</a></li>
    <li><a href="../tutorial/Tracing.html" class="page">Tracing</a></li>
  </ul></li>
  <li><a href="../reference/Index.html" class="page">Reference</a>
  <ul>
    <li><a href="../reference/Sessions.html" class="page">Sessions</a></li>
    <li><a href="../reference/TwiddleLists.html" class="page">Twiddle Lists</a></li>
    <li><a href="../reference/Encoders.html" class="active page">Encoders</a></li>
    <li><a href="../reference/Fragments.html" class="page">Fragments</a></li>
    <li><a href="../reference/Identifiers.html" class="page">Identifiers</a></li>
    <li><a href="../reference/Concurrency.html" class="page">Concurrency</a></li>
    <li><a href="../reference/SchemaTypes.html" class="page">Schema Types</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">Skunk</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Skunk
</a>
<div class="version-number">
0.4
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../tutorial/Index.html" class="page">Tutorial</a>
  <ul>
    <li><a href="../tutorial/Setup.html" class="page">Setup</a></li>
    <li><a href="../tutorial/Query.html" class="page">Queries</a></li>
    <li><a href="../tutorial/Command.html" class="page">Commands</a></li>
    <li><a href="../tutorial/Transactions.html" class="page">Transactions</a></li>
    <li><a href="../tutorial/Channels.html" class="page">Channels</a></li>
    <li><a href="../tutorial/Tracing.html" class="page">Tracing</a></li>
  </ul></li>
  <li><a href="../reference/Index.html" class="page">Reference</a>
  <ul>
    <li><a href="../reference/Sessions.html" class="page">Sessions</a></li>
    <li><a href="../reference/TwiddleLists.html" class="page">Twiddle Lists</a></li>
    <li><a href="../reference/Encoders.html" class="active page">Encoders</a></li>
    <li><a href="../reference/Fragments.html" class="page">Fragments</a></li>
    <li><a href="../reference/Identifiers.html" class="page">Identifiers</a></li>
    <li><a href="../reference/Concurrency.html" class="page">Concurrency</a></li>
    <li><a href="../reference/SchemaTypes.html" class="page">Schema Types</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Skunk</a></li>
  <li><a href="../reference/Index.html">Reference</a></li>
  <li>Encoders</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#encoders" name="encoders" class="anchor"><span class="anchor-link"></span></a>Encoders</h1>
<p>An encoder is needed any time you want to send a value to Postgres; i.e., any time a statement has parameters. Although it is possible to implement the <code>Encoder</code> interface directly, this requires knowledge of Postgres data formats and is not something you typically do as an end user. Instead you will use one or more existing encoders (see <a href="SchemaTypes.html">Schema Types</a>) composed or transformed as desired.</p>
<h2><a href="#base-encoders" name="base-encoders" class="anchor"><span class="anchor-link"></span></a>Base Encoders</h2>
<p>Base encoders are provided for many Postgres types (see <a href="SchemaTypes.html">Schema Types</a>). These encoders translate to a single placeholders in your SQL statement.</p><div class="callout note "><div class="callout-title">Definition</div>
<p>A <strong>base encoder</strong> maps a Scala type to a <em>single</em> Postgres schema type.</p></div>
<p>Here is a statement with an interpolated base encoder.</p>
<pre class="prettyprint"><code class="language-scala">sql&quot;SELECT name FROM country WHERE code = $varchar&quot;
// res0: Fragment[String] = Fragment(
//   parts = List(
//     Left(value = &quot;SELECT name FROM country WHERE code = &quot;),
//     Right(value = cats.data.IndexedStateT@65edd4be),
//     Left(value = &quot;&quot;)
//   ),
//   encoder = Codec(varchar),
//   origin = Origin(file = &quot;Encoders.md&quot;, line = 22)
// )
</code></pre>
<p>If there is more than one interpolated encoder (or an encoder composed of multiple smaller encoders, as we will see below) there will be multiple placeholders in the SQL statement, numbered sequentially.</p>
<pre class="prettyprint"><code class="language-scala">sql&quot;SELECT name FROM country WHERE code = $varchar AND population &lt; $int8&quot;
// res1: Fragment[String ~ Long] = Fragment(
//   parts = List(
//     Left(value = &quot;SELECT name FROM country WHERE code = &quot;),
//     Right(value = cats.data.IndexedStateT@65edd4be),
//     Left(value = &quot; AND population &lt; &quot;),
//     Right(value = cats.data.IndexedStateT@7b07da3e),
//     Left(value = &quot;&quot;)
//   ),
//   encoder = Codec(varchar, int8),
//   origin = Origin(file = &quot;Encoders.md&quot;, line = 29)
// )
</code></pre>
<h2><a href="#composite-encoders" name="composite-encoders" class="anchor"><span class="anchor-link"></span></a>Composite Encoders</h2>
<p>Given two encoders <code>a: Encoder[A]</code> and <code>b: Encoder[B]</code> we can create a composite encoder <code>a ~ b</code> of type <code>Encoder[(A, B)]</code>. Such an encoder expands to a sequence of placholders separated by commas.</p><div class="callout note "><div class="callout-title">Definition</div>
<p>A <strong>composite encoder</strong> maps a Scala type to a <em>sequence</em> of Postgres schema types.</p></div>
<p>Here is a statement with a composite encoder constructed from two base encoders.</p>
<pre class="prettyprint"><code class="language-scala">sql&quot;INSERT INTO person (name, age) VALUES (${varchar ~ int4})&quot;
// res2: Fragment[String ~ Int] = Fragment(
//   parts = List(
//     Left(value = &quot;INSERT INTO person (name, age) VALUES (&quot;),
//     Right(value = cats.data.IndexedStateT@37811bdc),
//     Left(value = &quot;)&quot;)
//   ),
//   encoder = Codec(varchar, int4),
//   origin = Origin(file = &quot;Encoders.md&quot;, line = 36)
// )
</code></pre>
<p>Here is a statement with a base encoder and a composite encoder constructed from three base encoders. Note that the composite structure is &ldquo;flattened&rdquo; in the resulting SQL statement; it is purely for convenience on the Scala side.</p>
<pre class="prettyprint"><code class="language-scala">val enc = varchar ~ int4 ~ float4
// enc: Codec[String ~ Int ~ Float] = Codec(varchar, int4, float4)

sql&quot;INSERT INTO person (comment, name, age, weight, comment) VALUES ($text, $enc)&quot;
// res3: Fragment[String ~ String ~ Int ~ Float] = Fragment(
//   parts = List(
//     Left(
//       value = &quot;INSERT INTO person (comment, name, age, weight, comment) VALUES (&quot;
//     ),
//     Right(value = cats.data.IndexedStateT@1bda8d9d),
//     Left(value = &quot;, &quot;),
//     Right(value = cats.data.IndexedStateT@547060f4),
//     Left(value = &quot;)&quot;)
//   ),
//   encoder = Codec(text, varchar, int4, float4),
//   origin = Origin(file = &quot;Encoders.md&quot;, line = 46)
// )
</code></pre>
<h2><a href="#combinators" name="combinators" class="anchor"><span class="anchor-link"></span></a>Combinators</h2>
<p>The <code>values</code> combinator adds parentheses around an encoder&rsquo;s generated placeholders.</p>
<pre class="prettyprint"><code class="language-scala">val enc = (varchar ~ int4).values
// enc: Encoder[String ~ Int] = Encoder(varchar, int4)

sql&quot;INSERT INTO person (name, age) VALUES $enc&quot;
// res4: Fragment[String ~ Int] = Fragment(
//   parts = List(
//     Left(value = &quot;INSERT INTO person (name, age) VALUES &quot;),
//     Right(value = cats.data.IndexedStateT@1163966e),
//     Left(value = &quot;&quot;)
//   ),
//   encoder = Encoder(varchar, int4),
//   origin = Origin(file = &quot;Encoders.md&quot;, line = 56)
// )
</code></pre>
<p>This can be very useful in combination with the <code>list</code> combinator, which creates an encoder for a list of values of a given length.</p>
<pre class="prettyprint"><code class="language-scala">val enc = (varchar ~ int4).values
// enc: Encoder[String ~ Int] = Encoder(varchar, int4)

sql&quot;INSERT INTO person (name, age) VALUES ${enc.list(3)}&quot;
// res5: Fragment[List[String ~ Int]] = Fragment(
//   parts = List(
//     Left(value = &quot;INSERT INTO person (name, age) VALUES &quot;),
//     Right(value = cats.data.IndexedStateT@2e832065),
//     Left(value = &quot;&quot;)
//   ),
//   encoder = Encoder(varchar, int4, varchar, int4, varchar, int4),
//   origin = Origin(file = &quot;Encoders.md&quot;, line = 66)
// )
</code></pre>
<h2><a href="#transforming-the-input-type" name="transforming-the-input-type" class="anchor"><span class="anchor-link"></span></a>Transforming the Input Type</h2>
<p>An <code>Encoder[A]</code> consumes a value of type <code>A</code> and encodes it for transmission Postgres, so it can therefore also consume anything that we can <em>turn into an <code>A</code></em>. We do this with <code>contramap</code>.</p>
<pre class="prettyprint"><code class="language-scala">case class Person(name: String, age: Int)

val person = (varchar ~ int4).values.contramap((p: Person) =&gt; p.name ~ p.age)
// person: Encoder[Person] = Encoder(varchar, int4)

sql&quot;INSERT INTO person (name, age) VALUES $person&quot;
// res6: Fragment[Person] = Fragment(
//   parts = List(
//     Left(value = &quot;INSERT INTO person (name, age) VALUES &quot;),
//     Right(value = cats.data.IndexedStateT@617af64d),
//     Left(value = &quot;&quot;)
//   ),
//   encoder = Encoder(varchar, int4),
//   origin = Origin(file = &quot;Encoders.md&quot;, line = 79)
// )
</code></pre>
<p>Because contramapping from case classes is so common, Skunk provides <code>gcontramap</code> which adapts an encoder to a case class of the same structure.</p>
<pre class="prettyprint"><code class="language-scala">case class Person(name: String, age: Int)

val person = (varchar ~ int4).values.gcontramap[Person]
// person: Encoder[Person] = Encoder(varchar, int4)

sql&quot;INSERT INTO person (name, age) VALUES $person&quot;
// res8: Fragment[Person] = Fragment(
//   parts = List(
//     Left(value = &quot;INSERT INTO person (name, age) VALUES &quot;),
//     Right(value = cats.data.IndexedStateT@36da4d56),
//     Left(value = &quot;&quot;)
//   ),
//   encoder = Encoder(varchar, int4),
//   origin = Origin(file = &quot;Encoders.md&quot;, line = 106)
// )
</code></pre>
<script type="text/javascript" src="../js/link_fix.js"></script>

<div class="source-github">
The source code for this page can be found <a id="source-link" href="https://github.com/tpolecat/skunk/tree/master/modules/docs/target/mdoc/reference/Encoders.md">here</a>.
</div>

<script type="text/javascript">jQuery(function(){sourceUrlFix('https://github.com/tpolecat/skunk/tree/master/modules/docs/target/mdoc/reference/Encoders.md')});</script>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../reference/Fragments.html">Fragments</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../reference/Encoders.html#encoders" class="header">Encoders</a>
  <ul>
    <li><a href="../reference/Encoders.html#base-encoders" class="header">Base Encoders</a></li>
    <li><a href="../reference/Encoders.html#composite-encoders" class="header">Composite Encoders</a></li>
    <li><a href="../reference/Encoders.html#combinators" class="header">Combinators</a></li>
    <li><a href="../reference/Encoders.html#transforming-the-input-type" class="header">Transforming the Input Type</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2022</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '0.4', 'https://github.com/tpolecat/skunk')});</script>


</html>
